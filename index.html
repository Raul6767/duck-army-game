<script>
let growTimer;

let factoryScore = 0;
let factoryGoal = 0;
let boxInterval;
let boxSpeed;
let factoryRarity;

// -------- MENU --------
function showFarmer() {
    hideAll();
    document.getElementById("farmerMenu").classList.remove("hidden");
}

function showMerchant() {
    hideAll();
    document.getElementById("merchantMenu").classList.remove("hidden");
}

function showFactory() {
    hideAll();
    document.getElementById("factoryMenu").classList.remove("hidden");
    startFactory();
}

function goBack() {
    hideAll();
    document.getElementById("mainMenu").classList.remove("hidden");
}

function hideAll() {
    document.getElementById("mainMenu").classList.add("hidden");
    document.getElementById("farmerMenu").classList.add("hidden");
    document.getElementById("merchantMenu").classList.add("hidden");
    document.getElementById("factoryMenu").classList.add("hidden");
}

// -------- FARMER --------
function startPlant() {
    let farm = document.getElementById("farmArea");
    let result = document.getElementById("result");

    result.innerHTML = "";
    farm.innerHTML = "üå±";

    let timeLeft = 5;

    growTimer = setInterval(function() {
        timeLeft--;

        if (timeLeft <= 0) {
            clearInterval(growTimer);
            growFlower();
        }
    }, 1000);
}

function growFlower() {
    let farm = document.getElementById("farmArea");
    let result = document.getElementById("result");

    let bad = ["üíÆ","üå∏","ü•Ä"];
    let rare = ["üåº","üåπ","üå∑"];
    let op = ["üåª","üíê","ü™∑","ü™ª","üå∫"];

    let r = Math.random();
    let chosen;

    if (r < 0.6) {
        chosen = bad[Math.floor(Math.random()*bad.length)];
        result.innerHTML = "Rarity: Bad";
    }
    else if (r < 0.9) {
        chosen = rare[Math.floor(Math.random()*rare.length)];
        result.innerHTML = "Rarity: Rare";
    }
    else {
        chosen = op[Math.floor(Math.random()*op.length)];
        result.innerHTML = "Rarity: OP üî•";
    }

    farm.innerHTML = chosen;
}

// -------- FACTORY --------
function startFactory() {
    factoryScore = 0;

    let area = document.getElementById("factoryArea");
    area.innerHTML = "";

    let r = Math.random();

    if (r < 0.6) {
        factoryRarity = "Bad";
        factoryGoal = randomRange(10,30);
        boxSpeed = 2; // slow
    }
    else if (r < 0.9) {
        factoryRarity = "Rare";
        factoryGoal = randomRange(40,60);
        boxSpeed = 4; // medium
    }
    else {
        factoryRarity = "OP";
        factoryGoal = randomRange(70,100);
        boxSpeed = 5; // slightly faster but clickable
    }

    updateScore();

    boxInterval = setInterval(createBox, 1000);
}

function createBox() {
    let area = document.getElementById("factoryArea");

    let box = document.createElement("div");
    box.classList.add("box");
    box.style.left = "-60px";

    area.appendChild(box);

    let position = -60;

    let move = setInterval(function() {
        position += boxSpeed;
        box.style.left = position + "px";

        if (position > area.offsetWidth) {
            clearInterval(move);
            box.remove();
        }
    }, 20);

    box.onclick = function() {
        factoryScore++;
        updateScore();
        box.remove();

        if (factoryScore >= factoryGoal) {
            clearInterval(boxInterval);
            alert("Factory Complete! üè≠üî•");
        }
    };
}

function updateScore() {
    document.getElementById("factoryScore").innerHTML =
        factoryScore + " / " + factoryGoal + " (" + factoryRarity + ")";
}

function randomRange(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function stopFactory() {
    clearInterval(boxInterval);
    goBack();
}
</script>
